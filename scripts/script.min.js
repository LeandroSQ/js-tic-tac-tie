!function t(e,i,s){function a(o,r){if(!i[o]){if(!e[o]){var h="function"==typeof require&&require;if(!r&&h)return h(o,!0);if(n)return n(o,!0);var l=Error("Cannot find module '"+o+"'");throw l.code="MODULE_NOT_FOUND",l}var c=i[o]={exports:{}};e[o][0].call(c.exports,(function(t){return a(e[o][1][t]||t)}),c,c.exports,t,e,i,s)}return i[o].exports}for(var n="function"==typeof require&&require,o=0;o<s.length;o++)a(s[o]);return a}({1:[function(t,e,i){e.exports=function(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t},e.exports.__esModule=!0,e.exports.default=e.exports},{}],2:[function(t,e,i){e.exports=function(t){return t&&t.__esModule?t:{default:t}},e.exports.__esModule=!0,e.exports.default=e.exports},{}],3:[function(t,e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.TIE=i.TARGET_FRAMETIME=i.TARGET_FPS=i.FONT_FAMILY=i.CELL_X=i.CELL_O=i.CELL_EMPTY=i.BORDER_RADIUS=void 0;i.BORDER_RADIUS=10;i.CELL_EMPTY=null;i.CELL_X=1;i.CELL_O=2;i.TIE=3;i.TARGET_FPS=24;i.TARGET_FRAMETIME=41.666666666666664;i.FONT_FAMILY="Poiret One"},{}],4:[function(t,e,i){function s(t,e){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.add(t)}function a(t,e,i){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return i}function n(t){const e=[];for(let i=0;i<t.length;i++)for(let s=0;s<t[i].length;s++){t[i][s]===l.CELL_EMPTY&&e.push(new d(s,i))}return e}function o(t){const e=[];for(let i=0;i<t.length;i++){const s=[];for(let e=0;e<t[i].length;e++){const a=t[i][e];s.push(a)}e.push(s)}return e}function r(t){const e=new c.Board(null);e.cells=t;const i=e.checkRules();return i===l.TIE?l.TIE:i?i.winner:null}function h(t,e,i){const s=a(this,f,r).call(this,t);if(s===l.CELL_O)return{score:10,move:null};if(s===l.CELL_X)return{score:-10,move:null};if(s===l.TIE)return{score:0,move:null};if(0===e)return{score:0,move:null};const o=a(this,u,n).call(this,t);if(i){let i=-1/0,s=null;for(const n of o){t[n.y][n.x]=l.CELL_O;const o=a(this,w,h).call(this,t,e-1,!1).score;t[n.y][n.x]=l.CELL_EMPTY,o>i&&(i=o,s=n)}return{score:i,move:s}}{let i=1/0,s=null;for(const n of o){t[n.y][n.x]=l.CELL_X;const o=a(this,w,h).call(this,t,e-1,!0).score;t[n.y][n.x]=l.CELL_EMPTY,i>o&&(i=o,s=n)}return{score:i,move:s}}}Object.defineProperty(i,"__esModule",{value:!0}),i.AIController=void 0;var l=t("../constants"),c=t("../model/board.js");class d{constructor(t,e){this.x=t,this.y=e}}var u=new WeakSet,m=new WeakSet,f=new WeakSet,w=new WeakSet;i.AIController=class{constructor(t){s(this,w),s(this,f),s(this,m),s(this,u),this.main=t,this.maxDepth=3}evaluate(){const t=a(this,m,o).call(this,this.main.board.cells),e=a(this,w,h).call(this,t,6,!0);return e}}},{"../constants":3,"../model/board.js":10}],5:[function(t,e,i){function s(t,e){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.add(t)}function a(t,e,i){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return i}function n(){const t=this.main.canvas.canvas;t.addEventListener("click",a(this,d,o).bind(this)),t.addEventListener("mousemove",a(this,u,r).bind(this))}function o(t){this.position={x:t.offsetX,y:t.offsetY},this.isClicking=!0,this.main.invalidate()}function r(t){this.position={x:t.offsetX,y:t.offsetY},this.main.invalidate()}var h=t("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(i,"__esModule",{value:!0}),i.MouseController=void 0;var l=h(t("@babel/runtime/helpers/defineProperty")),c=(t("../main"),new WeakSet),d=new WeakSet,u=new WeakSet;i.MouseController=class{constructor(t){s(this,u),s(this,d),s(this,c),(0,l.default)(this,"position",{x:0,y:0}),(0,l.default)(this,"isClicking",!1),this.main=t,a(this,c,n).call(this)}update(){this.isClicking=!1}}},{"../main":9,"@babel/runtime/helpers/defineProperty":1,"@babel/runtime/helpers/interopRequireDefault":2}],6:[function(t,e,i){function s(t,e){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.add(t)}function a(t,e,i){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return i}function n(){const t=["--background","--foreground","--dim-background","--board-background","--board-border","--player-x","--player-o"];console.groupCollapsed("Loading theme variables");const e=getComputedStyle(document.body);for(const i of t){const t=e.getPropertyValue(i),s=i.toString().toCamelCase();this[s]=t,console.log("%c"+s,`color: ${window.Color.isColorLight(t)?"#212121":"#eee"}; background-color: ${t}`)}console.groupEnd()}function o(){window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",(()=>{a(this,l,n).call(this),this.main.onThemeChange()}))}var r=t("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(i,"__esModule",{value:!0}),i.ThemeController=void 0;var h=r(t("@babel/runtime/helpers/defineProperty")),l=(t("./../main.js"),new WeakSet),c=new WeakSet;i.ThemeController=class{constructor(t){s(this,c),s(this,l),(0,h.default)(this,"background",void 0),(0,h.default)(this,"foreground",void 0),(0,h.default)(this,"dimBackground",void 0),(0,h.default)(this,"boardBackground",void 0),(0,h.default)(this,"boardBorder",void 0),(0,h.default)(this,"playerX",void 0),(0,h.default)(this,"playerO",void 0),this.main=t,a(this,l,n).call(this),a(this,c,o).call(this)}}},{"./../main.js":9,"@babel/runtime/helpers/defineProperty":1,"@babel/runtime/helpers/interopRequireDefault":2}],7:[function(t,e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.GameState=void 0;i.GameState={MENU:0,PLAYER_VS_PLAYER:1,PLAYER_VS_AI:2,TIE:3,PLAYER_WON:4}},{}],8:[function(t,e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.SoundEffect=void 0;i.SoundEffect={GAME_START:"game_start.wav",BUTTON_HOVER:"button_hover.wav",CELL_PLACE:"cel_place.wav",PEN_STROKE:"pen_stroke.wav"}},{}],9:[function(t,e,i){function s(t,e){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.add(t)}function a(t,e,i){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return i}function n(){window.addLoadEventListener(a(this,P,o).bind(this)),window.addEventListener("resize",a(this,C,r).bind(this)),window.addVisibilityChangeEventListener(this.onVisibilityChange.bind(this))}async function o(){try{this.canvas.attachToElement(document.getElementById("container")),a(this,C,r).call(this),await this.onThemeChange(),await b.FontLoader.load(this.ctx),await Promise.all([this.stateMenu.load(),this.statePlayerVsIA.load(),this.statePlayerVsPlayer.load(),this.statePlayerWon.load(),this.stateTie.load()]),a(this,_,l).call(this)}catch(t){console.error(t),alert("Some error ocurred!")}}async function r(){const t={width:window.innerWidth,height:window.innerHeight};this.board.layout(t),this.canvas.setSize(this.board),await this.onThemeChange()}function h(){if(this.paused)return;this.startFrameTime=performance.now();const t=(this.startFrameTime-this.lastFrameTime)/1e3;this.frameCounter++,this.fpsTimer+=t,this.fpsTimer>1&&(this.fpsTimer-=1,this.fps=this.frameCounter,this.frameCounter=0);const e=this.currentGameState;e.update(t),this.isDirty&&e===this.currentGameState&&(this.canvas.clear(),e.render(this.ctx),this.isDirty=!1),this.mouse.update(),a(this,_,l).call(this)}function l(){const t=this.lastFrameTime-this.startFrameTime,e=Math.clamp(c.TARGET_FRAMETIME-t,0,c.TARGET_FRAMETIME);setTimeout(a(this,L,h).bind(this),e),this.lastFrameTime=performance.now()}Object.defineProperty(i,"__esModule",{value:!0}),i.Main=void 0;var c=t("./constants.js"),d=t("./controller/mouse.js"),u=t("./controller/theme.js"),m=t("./enum/game-state.js"),f=t("./model/board.js"),w=t("./state/menu.js"),p=t("./state/player-vs-ai.js"),y=t("./state/player-vs-player.js"),v=t("./state/player-won.js"),g=t("./state/tie.js");t("./util/extensions.js");var b=t("./util/font-loader.js"),T=t("./util/image-loader.js"),E=t("./widget/density-canvas.js"),S=new WeakSet,P=new WeakSet,C=new WeakSet,L=new WeakSet,_=new WeakSet;class x{constructor(){s(this,_),s(this,L),s(this,C),s(this,P),s(this,S),this._state=m.GameState.MENU,this.stateMenu=new w.GameStateMenu(this),this.statePlayerVsPlayer=new y.GameStatePlayerVsPlayer(this),this.statePlayerVsIA=new p.GameStatePlayerVsIA(this),this.statePlayerWon=new v.GameStatePlayerWon(this),this.stateTie=new g.GameStateTie(this),this.paused=!1,this.canvas=new E.DensityCanvas,this.ctx=this.canvas.context,this.isDirty=!0,this.board=new f.Board(this),this.turn=Math.random()>.5?c.CELL_X:c.CELL_O,this.result=null,this.theme=new u.ThemeController(this),this.mouse=new d.MouseController(this),this.startFrameTime=performance.now(),this.lastFrameTime=performance.now(),this.frameCounter=0,this.fpsTimer=0,this.fps=0,a(this,S,n).call(this)}nextTurn(){this.turn==c.CELL_O?this.turn=c.CELL_X:this.turn=c.CELL_O}async onThemeChange(){const t=this.board.cellSize/1.5;this.imageO=await T.ImageLoader.load("ic_o.svg",{tint:this.theme.playerO,height:t}),this.imageX=await T.ImageLoader.load("ic_x.svg",{tint:this.theme.playerX,height:t}),this.isDirty=!0}onVisibilityChange(t){console.log(t),t?(this.paused=!1,this.lastFrameTime=performance.now(),this.startFrameTime=performance.now(),this.frameCounter=0,this.fpsTimer=0,this.fps=0,a(this,_,l).call(this)):this.paused=!0}invalidate(){this.isDirty=!0}postInvalidate(){setTimeout(this.invalidate.bind(this),0)}get currentGameState(){return{[m.GameState.MENU]:this.stateMenu,[m.GameState.PLAYER_VS_PLAYER]:this.statePlayerVsPlayer,[m.GameState.PLAYER_VS_AI]:this.statePlayerVsIA,[m.GameState.TIE]:this.stateTie,[m.GameState.PLAYER_WON]:this.statePlayerWon}[this.state]}get state(){return this._state}set state(t){this._state=t,this.currentGameState.setup()}}i.Main=x;const k=new x;window.instance=k},{"./constants.js":3,"./controller/mouse.js":5,"./controller/theme.js":6,"./enum/game-state.js":7,"./model/board.js":10,"./state/menu.js":12,"./state/player-vs-ai.js":13,"./state/player-vs-player.js":14,"./state/player-won.js":15,"./state/tie.js":16,"./util/extensions.js":18,"./util/font-loader.js":19,"./util/image-loader.js":20,"./widget/density-canvas.js":22}],10:[function(t,e,i){function s(t,e){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.add(t)}function a(t,e,i){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return i}function n(){a(this,T,u).call(this,"#");let t=0,e=null;for(t=0;t<this.rows;t++){e=this.cells[t][0];for(let i=1;i<this.columns;i++){const s=this.cells[t][i];if(s===m.CELL_EMPTY||s!==this.cells[t][i-1]){e=null;break}}if(e)break}return e?{winner:e,start:{x:0,y:t},end:{x:this.columns-1,y:t}}:null}function o(){a(this,T,u).call(this,"#");let t=0,e=null;for(t=0;t<this.columns;t++){e=this.cells[1][t];for(let i=1;i<this.rows;i++){const s=this.cells[i][t];if(s===m.CELL_EMPTY||s!==this.cells[i-1][t]){e=null;break}}if(e)break}return e?{winner:e,start:{x:t,y:0},end:{x:t,y:this.rows-1}}:null}function r(){a(this,T,u).call(this,"#");let t=this.cells[1][1];for(let e=1;e<this.columns;e++){const i=this.cells[e][e];if(i===m.CELL_EMPTY||i!==this.cells[e-1][e-1]){t=null;break}}return t?{winner:t,start:{x:0,y:0},end:{x:this.columns-1,y:this.rows-1}}:null}function h(){a(this,T,u).call(this,"#");let t=this.cells[1][1];for(let e=1;e<this.rows;e++){const i=e%(this.columns-1),s=this.cells[e][i];if(s===m.CELL_EMPTY||s!==this.cells[e-1][i+1]){t=null;break}}return t?{winner:t,start:{x:this.columns-1,y:0},end:{x:0,y:this.rows-1}}:null}function l(){return this.isBoardFilled?m.TIE:null}function c(t){for(let e=0;e<this.rows;e++)for(let i=0;i<this.columns;i++){const s=this.cells[e][i];if(!s)continue;t.shadowBlur=15,t.shadowOffsetX=0,t.shadowOffsetY=0,t.shadowColor=s===m.CELL_X?this.main.theme.playerX:this.main.theme.playerO;const a=s===m.CELL_X?this.main.imageX:this.main.imageO;a.drawBufferTo(this.x+i*this.cellSize+this.cellSize/2-a.width/2,this.y+e*this.cellSize+this.cellSize/2-a.height/2,t)}t.resetShadow()}function d(t){t.strokeStyle=this.main.theme.boardBorder,t.lineWidth=1;for(let e=1;e<this.rows;e++)t.beginPath(),t.moveTo(this.x,this.y+e*this.cellSize),t.lineTo(this.x+this.width,this.y+e*this.cellSize),t.stroke(),t.closePath();for(let e=1;e<this.columns;e++)t.beginPath(),t.moveTo(this.x+e*this.cellSize,this.y),t.lineTo(this.x+e*this.cellSize,this.y+this.height),t.stroke(),t.closePath()}function u(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:m.CELL_EMPTY;const e=[];for(let i=0;i<this.rows;i++){const i=[];for(let e=0;e<this.columns;e++)i.push(t);e.push(i)}return e}Object.defineProperty(i,"__esModule",{value:!0}),i.Board=void 0;var m=t("../constants"),f=new WeakSet,w=new WeakSet,p=new WeakSet,y=new WeakSet,v=new WeakSet,g=new WeakSet,b=new WeakSet,T=new WeakSet;i.Board=class{constructor(t){s(this,T),s(this,b),s(this,g),s(this,v),s(this,y),s(this,p),s(this,w),s(this,f),this.main=t,this.columns=3,this.rows=3,this.cellSize=0,this.x=0,this.y=0,this.width=0,this.height=0,this.reset()}layout(t){const e=this.main.canvas.drawRatio,i=Math.min(this.columns,this.rows);this.cellSize=Math.min(t.width,t.height)/(1.5*i),this.width=Math.ceil(this.cellSize*i+e),this.height=Math.ceil(this.cellSize*i+e)}checkRules(){return a(this,f,n).call(this)||a(this,w,o).call(this)||a(this,p,r).call(this)||a(this,y,h).call(this)||a(this,v,l).call(this)}render(t){a(this,b,d).call(this,t),a(this,g,c).call(this,t)}get isBoardFilled(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++){if(this.cells[t][e]===m.CELL_EMPTY)return!1}return!0}reset(){this.cells=a(this,T,u).call(this,m.CELL_EMPTY)}}},{"../constants":3}],11:[function(t,e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.GameStateBase=void 0;i.GameStateBase=class{constructor(t){this.main=t}async load(){}setup(){}update(t){}render(t){}get board(){return this.main.board}}},{}],12:[function(t,e,i){function s(t,e){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.add(t)}function a(t,e,i){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return i}function n(){this.audioGameStart.play(),this.board.reset(),this.main.postInvalidate(),document.body.style.cursor="unset",this.main.ctx.globalAlpha=1}function o(t){if(this.randomMovementTimer+=t+.05*Math.random(),this.randomMovementTimer>=this.intervalBetweenRandomMoves){this.randomMovementTimer-=this.intervalBetweenRandomMoves;this.board.isBoardFilled?this.board.reset():a(this,P,c).call(this)}}function r(t){this.shakeTimer+=t,this.shakeTimer<this.intervalBetweenShakes||(this.shakeTimer-=this.intervalBetweenShakes);const e=.5-Math.abs(this.shakeTimer/this.intervalBetweenShakes-.5);var i;this.shakeOffsetX=1+.25*(.5>(i=e)?4*i*i*i:1-Math.pow(-2*i+2,3)/2)}function h(t){this.buttonPlayerVsPlayer.update(t,this.main.mouse),this.buttonPlayerVsAI.update(t,this.main.mouse)}function l(t){document.body.style.cursor="cursor",this.main.mouse.isClicking&&(this.alreadyTapped=!0,this.alphaTimer=0)}function c(){if(null!=this.board.checkRules())return this.board.reset();let t=!1,e=null;for(;!t;)e={x:Math.randomIntRange(0,this.board.columns),y:Math.randomIntRange(0,this.board.rows)},this.board.cells[e.y][e.x]===m.CELL_EMPTY&&(t=!0);this.board.cells[e.y][e.x]=this.main.turn,this.main.nextTurn()}function d(t){t.save(),t.translate(this.main.canvas.width/2,this.main.canvas.height/2),t.scale(this.shakeOffsetX,this.shakeOffsetX),t.shadowColor=this.main.theme.dimBackground,t.fillStyle=this.main.theme.foreground,t.font="10pt "+m.FONT_FAMILY,t.fillTextCentered("Tap/click to start",0,0),t.restore()}function u(t){t.save(),t.shadowOffsetX=0,t.shadowOffsetY=4,t.shadowColor=this.main.theme.boardBackground,t.shadowBlur=7.5,t.fillStyle=this.main.theme.foreground,t.font="36pt "+m.FONT_FAMILY,t.fillTextCentered("Tic-Tac-Toe",this.main.canvas.width/2,this.main.canvas.height/3),this.buttonPlayerVsPlayer.render(t),this.buttonPlayerVsAI.render(t),t.translate(this.main.canvas.width/2,this.main.canvas.height/3+48),t.scale(this.shakeOffsetX,this.shakeOffsetX),t.shadowColor=this.main.theme.dimBackground,t.fillStyle=this.main.theme.foreground,t.font="10pt "+m.FONT_FAMILY,t.fillTextCentered("Select an option below",0,0),t.restore(),t.resetShadow()}Object.defineProperty(i,"__esModule",{value:!0}),i.GameStateMenu=void 0;var m=t("../constants.js"),f=t("../enum/game-state.js"),w=t("../enum/sound-effect.js"),p=t("../util/audio-loader.js"),y=(t("../util/image-loader.js"),t("../widget/button.js")),v=t("./base.js"),g=new WeakSet,b=new WeakSet,T=new WeakSet,E=new WeakSet,S=new WeakSet,P=new WeakSet,C=new WeakSet,L=new WeakSet;class _ extends v.GameStateBase{constructor(t){super(t),s(this,L),s(this,C),s(this,P),s(this,S),s(this,E),s(this,T),s(this,b),s(this,g),this.alreadyTapped=!1,this.alpha=0,this.alphaTimer=0,this.alphaAnimationDuration=1,this.randomMovementTimer=0,this.intervalBetweenRandomMoves=1.5,this.shakeTimer=0,this.intervalBetweenShakes=2,this.shakeOffsetX=0,this.audioGameStart=null}setup(){this.shakeTimer=0,this.randomMovementTimer=0,this.alpha=0,this.alphaTimer=0,this.board.reset()}async load(){this.audioGameStart=await p.AudioLoader.load(w.SoundEffect.GAME_START,{volume:.25});const t=this.board.width/4;let e=this.board.height/3+72;this.buttonPlayerVsPlayer=new y.Button({text:"Player vs Player",x:this.board.width/2-t/2,y:e,width:t,height:30,onClick:()=>{this.main.state=f.GameState.PLAYER_VS_PLAYER,a(this,g,n).call(this)}}),await this.buttonPlayerVsPlayer.load(),e+=45,this.buttonPlayerVsAI=new y.Button({text:"Player vs AI",x:this.board.width/2-t/2,y:e,width:t,height:30,onClick:()=>{this.main.state=f.GameState.PLAYER_VS_AI,a(this,g,n).call(this)}}),await this.buttonPlayerVsAI.load()}update(t){a(this,T,r).call(this,t),a(this,b,o).call(this,t),this.alreadyTapped?(document.body.style.cursor="unset",a(this,E,h).call(this,t)):a(this,S,l).call(this,t),this.alphaTimer<this.alphaAnimationDuration?this.alphaTimer+=t:this.alphaTimer=this.alphaAnimationDuration,this.alpha=Math.pow(this.alphaTimer/this.alphaAnimationDuration,2),this.main.invalidate()}render(t){t.save(),t.filter="blur(20px)",this.board.render(t),t.restore(),t.globalAlpha=this.alreadyTapped?1:this.alpha,t.beginPath(),t.fillStyle=this.main.theme.dimBackground,t.strokeStyle=this.main.theme.dimBackground,t.roundRect(0,0,this.main.canvas.width,this.main.canvas.height,m.BORDER_RADIUS*this.main.canvas.drawRatio),t.fill(),t.closePath(),this.alreadyTapped?(t.globalAlpha=this.alpha,a(this,L,u).call(this,t)):a(this,C,d).call(this,t)}}i.GameStateMenu=_},{"../constants.js":3,"../enum/game-state.js":7,"../enum/sound-effect.js":8,"../util/audio-loader.js":17,"../util/image-loader.js":20,"../widget/button.js":21,"./base.js":11}],13:[function(t,e,i){function s(t,e){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.add(t)}function a(t,e,i){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return i}function n(t){const e=this.main.mouse.position.x,i=this.main.mouse.position.y;let s=!1;if(!(e<this.board.x||e>this.board.x+this.board.width||i<this.board.y||i>this.board.y+this.board.height)){const t=Math.floor((e-this.board.x)/this.board.cellSize),n=Math.floor((i-this.board.y)/this.board.cellSize);s=this.board.cells[n][t]==h.CELL_EMPTY,s&&this.main.mouse.isClicking&&(this.board.cells[n][t]=this.main.turn,a(this,p,r).call(this))}document.body.style.cursor=s?"pointer":"unset"}function o(t){const e=this.ai.evaluate();this.board.cells[e.move.y][e.move.x]=this.main.turn,a(this,p,r).call(this),document.body.style.cursor="unset"}function r(){this.audioCellPlace.play();const t=this.board.checkRules();t&&"object"==typeof t?(this.main.result=t,this.main.state=c.GameState.PLAYER_WON):t===h.TIE?(this.main.result=t,this.main.state=c.GameState.TIE):this.main.nextTurn(),this.main.invalidate()}Object.defineProperty(i,"__esModule",{value:!0}),i.GameStatePlayerVsIA=void 0;var h=t("../constants.js"),l=t("../controller/ai.js"),c=t("../enum/game-state.js"),d=t("../enum/sound-effect.js"),u=t("../util/audio-loader.js"),m=t("./base.js"),f=new WeakSet,w=new WeakSet,p=new WeakSet;class y extends m.GameStateBase{constructor(t){super(t),s(this,p),s(this,w),s(this,f),this.audioCellPlace=null,this.ai=new l.AIController(this.main)}async load(){this.audioCellPlace=await u.AudioLoader.load(d.SoundEffect.CELL_PLACE,{volume:.15})}update(t){this.isPlayerTurn?a(this,f,n).call(this,t):this.isAiTurn&&a(this,w,o).call(this,t)}render(t){this.main.board.render(t)}get isPlayerTurn(){return this.main.turn===h.CELL_X}get isAiTurn(){return this.main.turn===h.CELL_O}}i.GameStatePlayerVsIA=y},{"../constants.js":3,"../controller/ai.js":4,"../enum/game-state.js":7,"../enum/sound-effect.js":8,"../util/audio-loader.js":17,"./base.js":11}],14:[function(t,e,i){function s(t,e){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.add(t)}function a(){this.audioCellPlace.play();const t=this.board.checkRules();t&&"object"==typeof t?(this.main.result=t,this.main.state=o.GameState.PLAYER_WON):t===n.TIE?(this.main.result=t,this.main.state=o.GameState.TIE):this.main.nextTurn(),this.main.invalidate()}Object.defineProperty(i,"__esModule",{value:!0}),i.GameStatePlayerVsPlayer=void 0;var n=t("../constants.js"),o=t("../enum/game-state.js"),r=t("../enum/sound-effect.js"),h=t("../util/audio-loader.js"),l=t("./base.js"),c=new WeakSet;class d extends l.GameStateBase{constructor(t){super(t),s(this,c),this.audioCellPlace=null}async load(){this.audioCellPlace=await h.AudioLoader.load(r.SoundEffect.CELL_PLACE,{volume:.15})}update(t){const e=this.main.mouse.position.x,i=this.main.mouse.position.y;let s=!1;if(!(e<this.board.x||e>this.board.x+this.board.width||i<this.board.y||i>this.board.y+this.board.height)){const t=Math.floor((e-this.board.x)/this.board.cellSize),o=Math.floor((i-this.board.y)/this.board.cellSize);s=this.board.cells[o][t]==n.CELL_EMPTY,s&&this.main.mouse.isClicking&&(this.board.cells[o][t]=this.main.turn,function(t,e,i){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return i}(this,c,a).call(this))}document.body.style.cursor=s?"pointer":"unset"}render(t){this.main.board.render(t)}}i.GameStatePlayerVsPlayer=d},{"../constants.js":3,"../enum/game-state.js":7,"../enum/sound-effect.js":8,"../util/audio-loader.js":17,"./base.js":11}],15:[function(t,e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.GameStatePlayerWon=void 0;var s=t("../constants.js"),a=t("../enum/game-state.js"),n=t("../enum/sound-effect.js"),o=t("../util/audio-loader.js"),r=t("./base.js");class h extends r.GameStateBase{constructor(t){super(t)}async load(){this.audioGameWon=await o.AudioLoader.load(n.SoundEffect.GAME_START,{volume:.1}),this.audioPenStroke=await o.AudioLoader.load(n.SoundEffect.PEN_STROKE,{volume:.5})}setup(){this.animationTimer=0,this.animationDuration=.159331,this.animationDone=!1,this.audioGameWon.play(),this.audioPenStroke.play(),document.body.style.cursor="pointer"}update(t){this.animationDone||(this.animationTimer+=t,this.animationTimer<this.animationDuration||(this.animationTimer=this.animationDuration,this.animationDone=!0),this.main.invalidate()),this.main.mouse.isClicking&&(this.main.state=a.GameState.MENU)}render(t){this.board.render(t);const e=this.animationProgress,i=this.board.cellSize,a=this.result.start,n=this.result.end,o=a.y===n.y?i/2:i/4;let r=a.x===n.x?i/2:i/4;a.x>n.x&&(r=i-r);const h=a.x*i+r,l=a.y*i+o,c=h*(1-e)+(n.x*i+i-r)*e,d=l*(1-e)+(n.y*i+i-o)*e;t.lineWidth=15,t.lineCap="round",t.lineJoin="round",t.strokeStyle="white",t.shadowBlur=15,t.shadowOffsetX=0,t.shadowOffsetY=0,t.shadowColor=this.result.winner===s.CELL_O?this.main.theme.playerO:this.main.theme.playerX,t.beginPath(),t.moveTo(h,l),t.lineTo(c,d),t.stroke(),t.resetShadow()}get result(){return this.main.result}get animationProgress(){return Math.pow(this.animationTimer/this.animationDuration,2)}}i.GameStatePlayerWon=h},{"../constants.js":3,"../enum/game-state.js":7,"../enum/sound-effect.js":8,"../util/audio-loader.js":17,"./base.js":11}],16:[function(t,e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.GameStateTie=void 0;var s=t("../constants.js"),a=t("../enum/game-state.js"),n=t("./base.js");class o extends n.GameStateBase{constructor(t){super(t)}async load(){}setup(){this.animationTimer=0,this.animationDuration=.159331,this.animationDone=!1,document.body.style.cursor="pointer"}update(t){this.animationDone||(this.animationTimer+=t,this.animationTimer<this.animationDuration||(this.animationTimer=this.animationDuration,this.animationDone=!0),this.main.invalidate()),this.main.mouse.isClicking&&(this.main.state=a.GameState.MENU)}render(t){this.board.render(t),t.save(),t.globalAlpha=this.animationProgress,t.shadowOffsetX=0,t.shadowOffsetY=4,t.shadowColor=this.main.theme.boardBackground,t.shadowBlur=7.5,t.fillStyle=this.main.theme.foreground,t.font="36pt "+s.FONT_FAMILY,t.fillTextCentered("Tie",this.main.canvas.width/2,this.main.canvas.height/3),t.restore()}get animationProgress(){return Math.pow(this.animationTimer/this.animationDuration,2)}}i.GameStateTie=o},{"../constants.js":3,"../enum/game-state.js":7,"./base.js":11}],17:[function(t,e,i){function s(t,e,i){return function(t,e){if(t!==e)throw new TypeError("Private static access of wrong provenance")}(t,e),i}function a(t){return(window.location.href.indexOf("http://localhost:")?window.location.href:window.location.pathname.substring(0,window.location.pathname.lastIndexOf("/")))+"/assets/audio/"+t}Object.defineProperty(i,"__esModule",{value:!0}),i.AudioLoader=void 0;t("../enum/sound-effect");class n{static load(t,e){let{volume:i=1}=e;return new Promise(((e,o)=>{const r=s(this,n,a).call(this,t),h=new Audio(r);h.preload="auto",h.volume=i,h.addEventListener("canplaythrough",(t=>{e(h)}),{once:!0}),h.onerror=t=>{o(t)},h.load()}))}}i.AudioLoader=n},{"../enum/sound-effect":8}],18:[function(t,e,i){Math.clamp=function(t,e,i){return t>i?i:e>t?e:t},Math.lerp=function(t,e,i){const s=e-t;return s>i?t+i:-i>s?t-i:t+s},Math.randomRange=function(t,e){return Math.random()*(e-t)+t},Math.randomIntRange=function(t,e){return Math.floor(Math.randomRange(t,e))},Array.prototype.random=function(){return this[Math.floor(Math.random()*this.length)]},window.addLoadEventListener=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3,i=!1;const s=()=>{i||(i=!0,t())};window.addEventListener("DOMContentLoaded",s),window.addEventListener("load",s),document.addEventListener("load",s),window.addEventListener("ready",s),setTimeout(s,e)},window.addVisibilityChangeEventListener=function(t){const e=["webkit","moz","ms",""];let i=!1;const s=()=>{if(i)return;i=!0;const s=e.map((t=>t&&t.length>0?t+"Hidden":"hidden")).map((t=>document[t])).reduce(((t,e)=>t||e),!1);t(!s),setTimeout((()=>{i=!1}),100)};for(const t of e)document.addEventListener(t+"visibilitychange",s);document.onvisibilitychange=s},CanvasRenderingContext2D.prototype.hasOwnProperty("roundRect")||(CanvasRenderingContext2D.prototype.roundRect=function(t,e,i,s,a){let n=a;n=Array.isArray(n)?n.length>1?{tl:n[0]||0,tr:n[1]||0,br:n[2]||0,bl:n[3]||0}:{tl:n[0],tr:n[0],br:n[0],bl:n[0]}:"number"==typeof n?{tl:n,tr:n,br:n,bl:n}:{tl:0,tr:0,br:0,bl:0,...n},this.beginPath(),this.moveTo(t+n.tl,e),this.lineTo(t+i-n.tr,e),this.quadraticCurveTo(t+i,e,t+i,e+n.tr),this.lineTo(t+i,e+s-n.br),this.quadraticCurveTo(t+i,e+s,t+i-n.br,e+s),this.lineTo(t+n.bl,e+s),this.quadraticCurveTo(t,e+s,t,e+s-n.bl),this.lineTo(t,e+n.tl),this.quadraticCurveTo(t,e,t+n.tl,e),this.closePath()}),String.prototype.toCamelCase=function(){return this.replace("--","").replace(/-./g,(t=>t[1].toUpperCase())).trim()},window.hasOwnProperty("Color")||(window.Color={}),window.Color.isColorLight=function(t){const e=+("0x"+t.trim().slice(1).replace(5>t.length&&/./g,"$&$&")),i=e>>16,s=e>>8&255,a=255&e;return Math.sqrt(i*i*.299+s*s*.587+a*a*.114)>127.5},console.matrix=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;e&&console.log(e);let i="%c";for(const e of t){for(let t=0;t<e.length;t++)i+=null===e[t]?"#":e[t],t<e.length-1&&(i+="");i+="\n"}console.log(i,"font-size: 1.2em; font-family: monospace; line-height: 0.6em")},HTMLCanvasElement.prototype.screenshot=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"download.png";const e=document.createElement("a");e.download=t,e.href=this.toDataURL("image/png;base64"),e.style.visibility="hidden",e.style.display="none",document.body.appendChild(e),setTimeout((()=>{e.click(),document.body.removeChild(e)}),100)},CanvasRenderingContext2D.prototype.fillTextCentered=function(t,e,i){this.save(),this.textAlign="center",this.textBaseline="middle",this.fillText(t,e,i),this.restore()},CanvasRenderingContext2D.prototype.resetShadow=function(){this.shadowOffsetX=0,this.shadowOffsetY=0,this.shadowColor="transparent",this.shadowBlur=0}},{}],19:[function(t,e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.FontLoader=void 0;var s=t("../constants");i.FontLoader=class{static async load(t){const e=[36,10].map((async t=>{const e=`${t}pt ${s.FONT_FAMILY}`;document.fonts.check(e)||await document.fonts.load(e)}));await Promise.all(e)}}},{"../constants":3}],20:[function(t,e,i){function s(t,e,i){return function(t,e){if(t!==e)throw new TypeError("Private static access of wrong provenance")}(t,e),i}function a(t){return(window.location.href.indexOf("http://localhost:")?window.location.href:window.location.pathname.substring(0,window.location.pathname.lastIndexOf("/")))+"/assets/images/"+t}function n(t){return new Promise(((e,i)=>{const n=document.createElement("img");n.src=s(this,r,a).call(this,t),n.onload=t=>{e(n)},n.onerror=t=>{i(t)}}))}Object.defineProperty(i,"__esModule",{value:!0}),i.ImageLoader=void 0;var o=t("../widget/density-canvas");class r{static async load(t,e){const i=await s(this,r,n).call(this,t);return e&&(e.width||e.height||e.tint)?this.process(i,e):i}static process(t,e){const i=new o.DensityCanvas,s=i.context;if(e.width&&e.height)t.width=e.width,t.height=e.height;else if(e.width&&!e.height){const i=t.height/t.width;t.width=e.width*i,t.height=e.width,e.height=t.width}else if(!e.width&&e.height){const i=t.width/t.height;t.width=e.height*i,t.height=e.height,e.width=t.width}else e.width||e.height||(e.width=t.width,e.height=t.height);return i.setSize(e),i.clear(),s.drawImage(t,(e.width-t.width)/2,(e.height-t.height)/2,t.width,t.height),e.tint&&(s.globalCompositeOperation="source-in",s.fillStyle=e.tint,s.fillRect(0,0,i.width,i.height)),i}}i.ImageLoader=r},{"../widget/density-canvas":22}],21:[function(t,e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.Button=void 0;var s=t("../constants"),a=t("../enum/sound-effect"),n=t("../util/audio-loader");i.Button=class{constructor(t){let{text:e,x:i,y:s,width:a,height:n,channel:o,onClick:r}=t;this.text=e,this.x=i,this.y=s,this.width=a,this.height=n,this.onClick=r,this.audioHover=null,this.isHovered=!1}async load(){this.audioHover=await n.AudioLoader.load(a.SoundEffect.BUTTON_HOVER,{volume:.05})}update(t,e){const i=this.isHovered,s=!(e.position.x<this.x||e.position.x>this.x+this.width||e.position.y<this.y||e.position.y>this.y+this.height);this.isHovered=s,this.isHovered&&(document.body.style.cursor="pointer",i&&!e.isClicking||this.audioHover.play(),e.isClicking&&this.onClick())}render(t){const e=window.instance.theme;t.beginPath(),t.fillStyle=this.isHovered?e.boardBorder:e.boardBackground,t.strokeStyle=this.isHovered?e.boardBackground:e.boardBorder,t.lineWidth=1,t.roundRect(this.x,this.y,this.width,this.height,s.BORDER_RADIUS),t.fill(),t.stroke(),t.closePath(),t.fillStyle=e.foreground,t.font="12pt "+s.FONT_FAMILY,t.fillTextCentered(this.text,this.x+this.width/2,this.y+this.height/2)}}},{"../constants":3,"../enum/sound-effect":8,"../util/audio-loader":17}],22:[function(t,e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.DensityCanvas=void 0;i.DensityCanvas=class{constructor(){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.virtualWidth=null,this.virtualHeight=null,this.enableHighDPI=!0}fullscreen(){this.canvas.onfullscreenerror=t=>{console.error(t)},this.canvas.requestFullscreen?this.canvas.requestFullscreen():this.canvas.webkitRequestFullscreen?this.canvas.webkitRequestFullscreen():this.canvas.msRequestFullscreen&&this.canvas.msRequestFullscreen()}get backingStoreRatio(){return this.enableHighDPI?this.context.webkitBackingStorePixelRatio||this.context.mozBackingStorePixelRatio||this.context.msBackingStorePixelRatio||this.context.oBackingStorePixelRatio||this.context.backingStorePixelRatio||1:.05}get devicePixelRatio(){return this.enableHighDPI?window.devicePixelRatio||1:.05}get drawRatio(){return this.devicePixelRatio/this.backingStoreRatio}setSize(t){let{width:e,height:i}=t;this.backingStoreRatio!==this.devicePixelRatio?(this.canvas.width=e*this.drawRatio,this.canvas.height=i*this.drawRatio,this.canvas.style.width=e+"px",this.canvas.style.minWidth=e+"px",this.canvas.style.height=i+"px",this.canvas.style.minHeight=i+"px"):(this.canvas.width=e,this.canvas.height=i,this.canvas.style.width="",this.canvas.style.height=""),this.context.scale(this.drawRatio,this.drawRatio),this.virtualWidth=e,this.virtualHeight=i}clear(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)}drawBufferTo(t,e,i){i.save(),i.scale(1/this.drawRatio,1/this.drawRatio),i.drawImage(this.canvas,t*this.drawRatio,e*this.drawRatio),i.restore()}attachToElement(t){t.appendChild(this.canvas)}get width(){return this.virtualWidth||this.canvas.width}get height(){return this.virtualHeight||this.canvas.height}}},{}]},{},[9]);
//# sourceMappingURL=script.min.js.map
